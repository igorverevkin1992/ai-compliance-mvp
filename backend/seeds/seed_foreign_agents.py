import os
from sqlalchemy import create_engine, text
import uuid

# –í—Å—Ç–∞–≤—å —Å–≤–æ—é —Å—Å—ã–ª–∫—É Supabase
DATABASE_URL = os.getenv("DATABASE_URL")
engine = create_engine(DATABASE_URL)

def seed_255_law():
    with engine.connect() as conn:
        print("üïµÔ∏è‚Äç‚ôÇÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –§–ó-255 (–ò–Ω–æ–∞–≥–µ–Ω—Ç—ã) –≤ –±–∞–∑—É...")
        
        # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –≤ Python
        doc_id = uuid.uuid4()
        
        # 2. –ü–µ—Ä–µ–¥–∞–µ–º –µ–≥–æ –≤ –∑–∞–ø—Ä–æ—Å
        conn.execute(text("""
            INSERT INTO legal_doc (id, publisher, title, version) 
            VALUES (:id, '–†–§', '–ù–∞–∑–≤–∞–Ω–∏–µ...', '–≤–µ—Ä—Å–∏—è...')
        """), {"id": doc_id})
        
        requirements = [
            {
                "code": "RF_255_LABELING_REQUIRED",
                "type": "MANDATORY",
                "risk": "HIGH",
                "summary": "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–Ω–æ–∞–≥–µ–Ω—Ç–∞.",
                "text": "–°—Ç–∞—Ç—å—è 9: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã, –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–µ –∏ (–∏–ª–∏) —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º—ã–µ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º –∞–≥–µ–Ω—Ç–æ–º, –¥–æ–ª–∂–Ω—ã —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—Ç—å—Å—è —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–∞ —Ç–æ, —á—Ç–æ —ç—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω—ã –∏–Ω–æ–∞–≥–µ–Ω—Ç–æ–º. –§–æ—Ä–º–∞ —É–∫–∞–∑–∞–Ω–∏—è: '–î–ê–ù–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï (–ú–ê–¢–ï–†–ò–ê–õ)...' (—Ç–µ–∫—Å—Ç –∏–∑ 24 —Å–ª–æ–≤)."
            },
            {
                "code": "RF_255_MENTION_LABEL",
                "type": "MANDATORY",
                "risk": "MEDIUM",
                "summary": "–ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ –∏–Ω–æ–∞–≥–µ–Ω—Ç–∞ –≤ –°–ú–ò.",
                "text": "–ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ –∏–Ω–æ–∞–≥–µ–Ω—Ç–∞ –≤ –°–ú–ò –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –µ–≥–æ —Å—Ç–∞—Ç—É—Å. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —É–∫–∞–∑–∞–Ω–∏—è –≤–ª–µ—á–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å."
            },
            {
                "code": "RF_255_KIDS_CONTENT_BAN",
                "type": "PROHIBITED",
                "risk": "CRITICAL",
                "summary": "–ó–∞–ø—Ä–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –¥–µ—Ç–µ–π –∏–Ω–æ–∞–≥–µ–Ω—Ç–∞–º–∏.",
                "text": "–°—Ç–∞—Ç—å—è 11 —á.10: –ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç –Ω–µ –≤–ø—Ä–∞–≤–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—É—é –ø—Ä–æ–¥—É–∫—Ü–∏—é –¥–ª—è –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–Ω–∏—Ö. –ö–Ω–∏–≥–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏–Ω–æ–∞–≥–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –º–∞—Ä–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è 18+."
            },
            {
                "code": "RF_255_TEACHING_BAN",
                "type": "PROHIBITED",
                "risk": "HIGH",
                "summary": "–ó–∞–ø—Ä–µ—Ç –Ω–∞ –ø—Ä–æ—Å–≤–µ—Ç–∏—Ç–µ–ª—å—Å–∫—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–æ–∞–≥–µ–Ω—Ç–æ–≤.",
                "text": "–°—Ç–∞—Ç—å—è 11 —á.9: –ò–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç –Ω–µ –≤–ø—Ä–∞–≤–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å –ø—Ä–æ—Å–≤–µ—Ç–∏—Ç–µ–ª—å—Å–∫—É—é –∏ –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫—É—é –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö."
            }
        ]
        
        for req in requirements:
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
            req_id = uuid.uuid4()

            conn.execute(text("""
                INSERT INTO legal_requirement (id, doc_id, req_code, requirement_type, risk_floor, summary, full_text)
                VALUES (:id, :doc_id, :code, :type, :risk, :summ, :text)
                ON CONFLICT (req_code) DO UPDATE SET full_text = EXCLUDED.full_text
            """), {
                "id": req_id,       # <--- –î–û–ë–ê–í–õ–ï–ù–û
                "doc_id": doc_id,
                "code": req["code"],
                "type": req["type"],
                "risk": req["risk"],
                "summ": req["summary"],
                "text": req["text"]
            })
        
        conn.commit()
        print("‚úÖ –§–ó-255 (–ò–Ω–æ–∞–≥–µ–Ω—Ç—ã) —É—Å–ø–µ—à–Ω–æ –æ—Ü–∏—Ñ—Ä–æ–≤–∞–Ω.")

if __name__ == "__main__":
    seed_255_law()