import sys
import os
import json
import uuid

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from sqlalchemy import create_engine, text
import google.generativeai as genai
from database import Base, engine as db_engine

DATABASE_URL = os.getenv("DATABASE_URL") 
GEMINI_API_KEY = os.getenv("GEMINI_API_KEY") # <--- –¢–µ–ø–µ—Ä—å –±–µ—Ä–µ—Ç –∏–∑ .env

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
if not GEMINI_API_KEY:
    print("‚ùå –û—à–∏–±–∫–∞: GEMINI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª .env")
    exit(1)

genai.configure(api_key=GEMINI_API_KEY)
engine = create_engine(DATABASE_URL)

def get_vector(text_to_embed):
    try:
        result = genai.embed_content(
            model="models/text-embedding-004",
            content=text_to_embed,
            task_type="retrieval_document"
        )
        return result['embedding']
    except Exception as e:
        print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞: {e}")
        return None

# 10 –ó–û–õ–û–¢–´–• –ö–ï–ô–°–û–í (–û–ë–ù–û–í–õ–ï–ù–ù–´–ï –ü–û–î –ù–û–í–´–ï –ó–ê–ö–û–ù–´)
hard_cases = [
    {
        "title": "–§–µ–π–∫ –æ –í–° –†–§ (–ë—É—á–∞/–ò—Ä–ø–µ–Ω—å –Ω–∞—Ä—Ä–∞—Ç–∏–≤)",
        "description": "–£—á–∞—Å—Ç–Ω–∏–∫ —Ç–æ–∫-—à–æ—É —É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ '–ø—Ä–µ–¥–Ω–∞–º–µ—Ä–µ–Ω–Ω—ã—Ö —É–¥–∞—Ä–∞—Ö –í–° –†–§ –ø–æ –∂–∏–ª—ã–º –∫–≤–∞—Ä—Ç–∞–ª–∞–º', –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—è –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ú–∏–Ω–æ–±–æ—Ä–æ–Ω—ã.",
        "risk": "CRITICAL",
        "json": {
            "overall": {"risk_level": "CRITICAL", "confidence": 1.0, "age_rating": "18+", "summary": "–ü—É–±–ª–∏—á–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–µ–¥–æ–º–æ –ª–æ–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –í–° –†–§ (—Å—Ç. 207.3 –£–ö –†–§)."},
            "labels": [{"code": "RF_UK_207_3_ARMY_FAKES", "severity": 3, "confidence": 1.0, "rationale": "–£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –±—Ä–∏—Ñ–∏–Ω–≥–∞–º –ú–∏–Ω–æ–±–æ—Ä–æ–Ω—ã –†–§ –∏ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ –≤–æ–µ–Ω–Ω—ã–π —Ñ–µ–π–∫.", "policy_refs": ["RF_UK_207_3"]}],
            "recommendations": [{"action": "CUT", "priority": "P0", "expected_effect": "–ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ —É–≥–æ–ª–æ–≤–Ω–æ–≥–æ –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (–¥–æ 15 –ª–µ—Ç –ª–∏—à–µ–Ω–∏—è —Å–≤–æ–±–æ–¥—ã)."}]
        }
    },
    {
        "title": "–î–∏—Å–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è –∞—Ä–º–∏–∏ (–°–∏–º–≤–æ–ª–∏–∫–∞/–ü–ª–∞–∫–∞—Ç—ã)",
        "description": "–í –∫–∞–¥—Ä–µ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–ø–∞ –Ω–∞ —Å—Ç–µ–Ω–µ –≤–∏–¥–µ–Ω –ø–ª–∞–∫–∞—Ç '–ù–µ—Ç –≤***–µ' –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø–∞—Ü–∏—Ñ–∏—Å—Ç—Å–∫–∞—è —Å–∏–º–≤–æ–ª–∏–∫–∞ –≤ —Ç–µ–∫—É—â–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.",
        "risk": "CRITICAL",
        "json": {
            "overall": {"risk_level": "CRITICAL", "confidence": 0.98, "age_rating": "18+", "summary": "–î–∏—Å–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –í–° –†–§ (—Å—Ç. 280.3 –£–ö –†–§)."},
            "labels": [{"code": "RF_UK_280_3_DISCREDITATION", "severity": 3, "confidence": 1.0, "rationale": "–ü—É–±–ª–∏—á–Ω–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ª–æ–∑—É–Ω–≥–æ–≤, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–¥—Ä—ã–≤ –¥–æ–≤–µ—Ä–∏—è –∫ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—é –°–í–û.", "policy_refs": ["RF_UK_280_3"]}],
            "recommendations": [{"action": "BLUR", "priority": "P0", "params": {"target": "poster_background"}, "expected_effect": "–°–∫—Ä—ã—Ç–∏–µ –¥–∏—Å–∫—Ä–µ–¥–∏—Ç–∏—Ä—É—é—â–µ–π –Ω–∞–¥–ø–∏—Å–∏."}]
        }
    },
    {
        "title": "–õ–ì–ë–¢-–ø—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ (–ü–æ—Ü–µ–ª—É–π)",
        "description": "–í —Å–µ—Ä–∏–∞–ª–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Å—Ü–µ–Ω–∞ –¥–æ–ª–≥–æ–≥–æ –ø–æ—Ü–µ–ª—É—è –¥–≤—É—Ö –º—É–∂—á–∏–Ω —Å —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ–º.",
        "risk": "CRITICAL",
        "json": {
            "overall": {"risk_level": "CRITICAL", "confidence": 1.0, "age_rating": "18+", "summary": "–ü—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ –Ω–µ—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö —Å–µ–∫—Å—É–∞–ª—å–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π (—Å—Ç. 6.21 –ö–æ–ê–ü –†–§)."},
            "labels": [{"code": "RF_KOAP_LGBT_PROPAGANDA", "severity": 3, "confidence": 1.0, "rationale": "–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ—Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π —á–µ—Ä–µ–∑ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é.", "policy_refs": ["NTV_LGBT_PROPAGANDA_PROHIBITED", "RF_KOAP_6_21"]}],
            "recommendations": [{"action": "CUT", "priority": "P0", "expected_effect": "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã. –®—Ç—Ä–∞—Ñ –¥–ª—è —é—Ä–ª–∏—Ü –¥–æ 5 –º–ª–Ω —Ä—É–±–ª–µ–π."}]
        }
    },
    {
        "title": "–ò–Ω–æ–∞–≥–µ–Ω—Ç –±–µ–∑ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏",
        "description": "–ò–Ω—Ç–µ—Ä–≤—å—é —Å –ª–∏—Ü–æ–º, –≤–Ω–µ—Å–µ–Ω–Ω—ã–º –≤ —Ä–µ–µ—Å—Ç—Ä –∏–Ω–æ–∞–≥–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∂—É—Ä–Ω–∞–ª–∏—Å—Ç), –±–µ–∑ 15-—Å–µ–∫—É–Ω–¥–Ω–æ–π –ø–ª–∞—à–∫–∏.",
        "risk": "HIGH",
        "json": {
            "overall": {"risk_level": "HIGH", "confidence": 1.0, "age_rating": "18+", "summary": "–ù–∞—Ä—É—à–µ–Ω–∏–µ –§–ó-255 '–û –∫–æ–Ω—Ç—Ä–æ–ª–µ –∑–∞ –ª–∏—Ü–∞–º–∏, –Ω–∞—Ö–æ–¥—è—â–∏–º–∏—Å—è –ø–æ–¥ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω—ã–º –≤–ª–∏—è–Ω–∏–µ–º'."},
            "labels": [{"code": "RF_255_LABELING_REQUIRED", "severity": 2, "confidence": 1.0, "rationale": "–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–Ω–æ–∞–≥–µ–Ω—Ç–∞ –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ (24 —Å–ª–æ–≤–∞).", "policy_refs": ["NTV_FOREIGNAGENT_LABEL_001"]}],
            "recommendations": [{"action": "OVERLAY", "priority": "P1", "params": {"text": "–î–ê–ù–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï (–ú–ê–¢–ï–†–ò–ê–õ) –°–û–ó–î–ê–ù–û –ò (–ò–õ–ò)..."}, "expected_effect": "–°–æ–±–ª—é–¥–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–∞. –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–Ω–∏–º–∞—Ç—å 20% —ç–∫—Ä–∞–Ω–∞."}]
        }
    },
    {
        "title": "–†–µ–∫–ª–∞–º–∞ –û–Ω–ª–∞–π–Ω-–ö–∞–∑–∏–Ω–æ (–°—Ç—Ä–∏–º–µ—Ä)",
        "description": "–ë–ª–æ–≥–µ—Ä –∫—Ä—É—Ç–∏—Ç —Å–ª–æ—Ç—ã (–∫–∞–∑–∏–Ω–æ) –≤ –ø—Ä—è–º–æ–º —ç—Ñ–∏—Ä–µ –∏ –¥–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ —á–∞—Ç–µ.",
        "risk": "CRITICAL",
        "json": {
            "overall": {"risk_level": "CRITICAL", "confidence": 1.0, "age_rating": "18+", "summary": "–ù–µ–∑–∞–∫–æ–Ω–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–∫–ª–∞–º–∞ –∞–∑–∞—Ä—Ç–Ω—ã—Ö –∏–≥—Ä (–§–ó-244)."},
            "labels": [{"code": "RF_GAMBLING_ONLINE_CASINO", "severity": 3, "confidence": 1.0, "rationale": "–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–Ω–ª–∞–π–Ω-–∫–∞–∑–∏–Ω–æ –≤ –†–§ –∑–∞–ø—Ä–µ—â–µ–Ω–∞. –†–µ–∫–ª–∞–º–∞ —Ç–∞–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –≤–ª–µ—á–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∫–∞–Ω–∞–ª–∞.", "policy_refs": ["RF_FZ_244"]}],
            "recommendations": [{"action": "CUT", "priority": "P0", "expected_effect": "–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞. –î–∞–Ω–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–µ –ø–æ–¥–ª–µ–∂–∏—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –†–§."}]
        }
    },
    {
        "title": "–ü—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ –ß–∞–π–ª–¥—Ñ—Ä–∏",
        "description": "–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –º–æ–Ω–æ–ª–æ–≥: '–î–µ—Ç–∏ ‚Äî —ç—Ç–æ –º—É—Å–æ—Ä, –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–æ–∂–∞–π—Ç–µ, –∂–∏–≤–∏—Ç–µ –¥–ª—è —Å–µ–±—è'.",
        "risk": "HIGH",
        "json": {
            "overall": {"risk_level": "HIGH", "confidence": 0.95, "age_rating": "18+", "summary": "–ü—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ –æ—Ç–∫–∞–∑–∞ –æ—Ç –¥–µ—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è (–ö–æ–ê–ü 6.21)."},
            "labels": [{"code": "RF_KOAP_CHILDFREE", "severity": 2, "confidence": 0.95, "rationale": "–ù–∞–≤—è–∑—ã–≤–∞–Ω–∏–µ –∏–¥–µ–æ–ª–æ–≥–∏–∏ –æ—Ç–∫–∞–∑–∞ –æ—Ç –¥–µ—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏—è –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ —Å–µ–º—å–∏.", "policy_refs": ["RF_KOAP_6_21"]}],
            "recommendations": [{"action": "CUT", "priority": "P1", "expected_effect": "–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–ø–∞–≥–∞–Ω–¥–∏—Å—Ç—Å–∫–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞."}]
        }
    },
    {
        "title": "–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤ –≤–µ—Ä—É—é—â–∏—Ö",
        "description": "–ë–ª–æ–≥–µ—Ä —Ç–∞–Ω—Ü—É–µ—Ç –≤ —Ü–µ—Ä–∫–≤–∏ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–∫–æ–Ω—ã –≤ –Ω–µ–ø—Ä–∏—Å—Ç–æ–π–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.",
        "risk": "CRITICAL",
        "json": {
            "overall": {"risk_level": "CRITICAL", "confidence": 1.0, "age_rating": "18+", "summary": "–ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–≤–æ–±–æ–¥—É —Å–æ–≤–µ—Å—Ç–∏ (—Å—Ç. 148 –£–ö –†–§)."},
            "labels": [{"code": "RF_UK_148_SACRED_PLACE", "severity": 3, "confidence": 1.0, "rationale": "–ü—É–±–ª–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –º–µ—Å—Ç–µ –±–æ–≥–æ—Å–ª—É–∂–µ–Ω–∏—è, –≤—ã—Ä–∞–∂–∞—é—â–∏–µ —è–≤–Ω–æ–µ –Ω–µ—É–≤–∞–∂–µ–Ω–∏–µ.", "policy_refs": ["RF_UK_148"]}],
            "recommendations": [{"action": "CUT", "priority": "P0", "expected_effect": "–£–¥–∞–ª–µ–Ω–∏–µ —ç–ø–∏–∑–æ–¥–∞. –£–≥–æ–ª–æ–≤–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å."}]
        }
    },
    {
        "title": "–°–∫—Ä—ã—Ç–∞—è —Ä–µ–∫–ª–∞–º–∞ –±–µ–∑ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)",
        "description": "–ë–ª–æ–≥–µ—Ä –ø—å–µ—Ç –≥–∞–∑–∏—Ä–æ–≤–∫—É –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ –±—Ä–µ–Ω–¥–∞, —Ö–≤–∞–ª–∏—Ç –≤–∫—É—Å –∏ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç —ç—Ç–∏–∫–µ—Ç–∫—É –≤ –∫–∞–º–µ—Ä—É, –Ω–æ –ø–ª–∞—à–∫–∏ '–†–µ–∫–ª–∞–º–∞' –Ω–µ—Ç.",
        "risk": "MEDIUM",
        "json": {
            "overall": {"risk_level": "MEDIUM", "confidence": 0.9, "age_rating": "12+", "summary": "–ù–∞—Ä—É—à–µ–Ω–∏–µ –§–ó-38 '–û —Ä–µ–∫–ª–∞–º–µ' (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏)."},
            "labels": [{"code": "RF_AD_DISCLAIMER_REQUIRED", "severity": 2, "confidence": 0.9, "rationale": "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–∞ –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ (erid) –∏ –ø–æ–º–µ—Ç–∫–∏ '–†–µ–∫–ª–∞–º–∞'. –®—Ç—Ä–∞—Ñ –¥–æ 500 —Ç—ã—Å. —Ä—É–±.", "policy_refs": ["RF_FZ_38"]}],
            "recommendations": [{"action": "OVERLAY", "priority": "P1", "params": {"text": "–†–µ–∫–ª–∞–º–∞. –û–û–û '–ë—Ä–µ–Ω–¥'. erid: ..."}, "expected_effect": "–õ–µ–≥–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∫–ª–∞–º–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏."}]
        }
    },
    {
        "title": "–ú–∞—Ç –≤ —ç—Ñ–∏—Ä–µ (–ù–¢–í/–¢–í –ø—Ä–æ—Ñ–∏–ª—å)",
        "description": "–ì–µ—Ä–æ–π —Ñ–∏–ª—å–º–∞ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç '–ë–ª*–¥—å' –≤ –¥–Ω–µ–≤–Ω–æ–µ –≤—Ä–µ–º—è (14:00).",
        "risk": "HIGH",
        "json": {
            "overall": {"risk_level": "HIGH", "confidence": 1.0, "age_rating": "16+", "summary": "–ù–∞—Ä—É—à–µ–Ω–∏–µ –§–ó –æ –∑–∞—â–∏—Ç–µ –¥–µ—Ç–µ–π (–§–ó-436) –∏ –ó–∞–∫–æ–Ω–∞ –æ –°–ú–ò."},
            "labels": [{"code": "RF_MEDIA_ABUSE_GEN", "severity": 2, "confidence": 1.0, "rationale": "–ù–µ—Ü–µ–Ω–∑—É—Ä–Ω–∞—è –±—Ä–∞–Ω—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—Ä–µ—â–µ–Ω–∞ –≤ –°–ú–ò. –¢—Ä–µ–±—É–µ—Ç—Å—è '–∑–∞–ø–∏–∫–∏–≤–∞–Ω–∏–µ'.", "policy_refs": ["NTV_BAN_OBSCENE_001"]}],
            "recommendations": [{"action": "BLEEP", "priority": "P0", "expected_effect": "–ü–æ–ª–Ω–æ–µ –∑–∞–≥–ª—É—à–µ–Ω–∏–µ –∑–≤—É–∫–∞ (Silence/Beep) –Ω–∞ —Å–ª–æ–≤–µ."}]
        }
    },
    {
        "title": "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—é –Ω–∞—Ä–∫–æ—Ç–∏–∫–æ–≤",
        "description": "–í —Å–µ—Ä–∏–∞–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å —Å–º–µ—à–∏–≤–∞–Ω–∏—è —Ö–∏–º–∏–∫–∞—Ç–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–≥–æ –≤–µ—â–µ—Å—Ç–≤–∞.",
        "risk": "CRITICAL",
        "json": {
            "overall": {"risk_level": "CRITICAL", "confidence": 1.0, "age_rating": "18+", "summary": "–ü—Ä–æ–ø–∞–≥–∞–Ω–¥–∞ –Ω–∞—Ä–∫–æ—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤ (—Å—Ç. 6.13 –ö–æ–ê–ü, —Å—Ç. 46 –§–ó-38)."},
            "labels": [{"code": "RF_MEDIA_DRUGS_METHODS", "severity": 3, "confidence": 1.0, "rationale": "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Ä–∫–æ—Ç–∏–∫–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–∞, –¥–∞–∂–µ –≤ —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ü–µ–ª—è—Ö.", "policy_refs": ["RF_FZ_38", "RF_FZ_436"]}],
            "recommendations": [{"action": "CUT", "priority": "P0", "expected_effect": "–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ü–µ–Ω—ã –∏–ª–∏ —Å–∏–ª—å–Ω—ã–π BLUR –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞."}]
        }
    }
]

def seed():
    print("üõ† –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    Base.metadata.create_all(bind=db_engine)

    with engine.connect() as conn:
        print("üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ 10 –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã—Ö –ö–µ–π—Å–æ–≤ (v6.3 Compliance Bible)...")
        
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º UUID –¥–ª—è –∞—Å—Å–µ—Ç–∞-–º–µ—Ç–æ–¥–∏—á–∫–∏
        asset_id = uuid.uuid4()
        conn.execute(text("""
            INSERT INTO media_asset (id, filename, metadata) 
            VALUES (:id, 'Compliance_Bible_Expert_Guide_v6', '{"type": "gold_dataset", "version": "2.0"}')
        """), {"id": asset_id})

        for case in hard_cases:
            # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º UUID –¥–ª—è —Ä–µ–≤—å—é
            review_id = uuid.uuid4()
            
            # 2. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ human_review
            conn.execute(text("""
                INSERT INTO human_review (id, asset_id, final_risk, notes, verified_json, status)
                VALUES (:id, :aid, :risk, :notes, :v_json, 'DONE')
            """), {
                "id": review_id,
                "aid": asset_id, 
                "risk": case['risk'], 
                "notes": f"CASE: {case['title']}. DESC: {case['description']}",
                "v_json": json.dumps(case['json'])
            })

            # 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º UUID –∏ –í–µ–∫—Ç–æ—Ä –¥–ª—è –ø–∞–º—è—Ç–∏
            search_text = f"{case['title']} {case['description']}"
            vector = get_vector(search_text)
            
            if vector:
                mem_id = uuid.uuid4()
                conn.execute(text("""
                    INSERT INTO case_memory (id, review_id, memory_type, text, embedding, meta)
                    VALUES (:id, :rid, 'EXPERT_GOLD_CASE', :txt, :vec, :meta)
                """), {
                    "id": mem_id,
                    "rid": review_id,
                    "txt": f"–ö–ï–ô–°: {case['description']} | –í–ï–†–î–ò–ö–¢: {case['risk']}",
                    "vec": str(vector),
                    "meta": json.dumps({
                        "title": case['title'], 
                        "labels": [l['code'] for l in case['json']['labels']]
                    })
                })
                print(f"‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∫–µ–π—Å: {case['title']}")
        
        conn.commit()
    print("\n‚ú® –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô –û–ë–ù–û–í–õ–ï–ù–ê. –ê–≥–µ–Ω—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.")

if __name__ == "__main__":
    seed()