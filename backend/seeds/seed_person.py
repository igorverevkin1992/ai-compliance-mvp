import os
from sqlalchemy import create_engine, text
import uuid

# –í—Å—Ç–∞–≤—å —Å–≤–æ—é —Å—Å—ã–ª–∫—É Supabase
DATABASE_URL = os.getenv("DATABASE_URL")
engine = create_engine(DATABASE_URL)

def seed_gk_152():
    with engine.connect() as conn:
        print("üì∏ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç. 152.1 –ì–ö –†–§ (–ü—Ä–∞–≤–æ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ) –≤ –±–∞–∑—É...")
        
        # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –≤ Python
        doc_id = uuid.uuid4()
        
        # 2. –ü–µ—Ä–µ–¥–∞–µ–º –µ–≥–æ –≤ –∑–∞–ø—Ä–æ—Å
        conn.execute(text("""
            INSERT INTO legal_doc (id, publisher, title, version) 
            VALUES (:id, '–†–§', '–ù–∞–∑–≤–∞–Ω–∏–µ...', '–≤–µ—Ä—Å–∏—è...')
        """), {"id": doc_id})
        
        requirements = [
            {
                "code": "RF_GK_152_CONSENT_REQUIRED",
                "type": "RESTRICTED",
                "risk": "MEDIUM",
                "summary": "–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞ (–∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω).",
                "text": "–°—Ç–∞—Ç—å—è 152.1 –ø.1: –û–±–Ω–∞—Ä–æ–¥–æ–≤–∞–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞ (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ) –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å —Å–æ–≥–ª–∞—Å–∏—è —ç—Ç–æ–≥–æ –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞. –°–æ–≥–ª–∞—Å–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö/–ø—É–±–ª–∏—á–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö."
            },
            {
                "code": "RF_GK_152_PUBLIC_PLACE_EXCEPTION",
                "type": "PERMITTED",
                "risk": "SAFE",
                "summary": "–°—ä–µ–º–∫–∞ –≤ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö (—Ñ–æ–Ω–æ–≤–∞—è) —Ä–∞–∑—Ä–µ—à–µ–Ω–∞ –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è.",
                "text": "–°—Ç–∞—Ç—å—è 152.1 –ø.1 –ø–ø.2: –°–æ–≥–ª–∞—Å–∏–µ –ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è, –µ—Å–ª–∏ —Å—ä–µ–º–∫–∞ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –≤ –º–µ—Å—Ç–∞—Ö, –æ—Ç–∫—Ä—ã—Ç—ã—Ö –¥–ª—è —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è, –∏–ª–∏ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö (–∫–æ–Ω—Ü–µ—Ä—Ç—ã, —Å—ä–µ–∑–¥—ã), –ó–ê –ò–°–ö–õ–Æ–ß–ï–ù–ò–ï–ú —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ç–∞–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –û–°–ù–û–í–ù–´–ú –æ–±—ä–µ–∫—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω, –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –ª–∏—Ü–µ)."
            },
            {
                "code": "RF_GK_152_PAID_MODEL",
                "type": "PERMITTED",
                "risk": "SAFE",
                "summary": "–°–æ–≥–ª–∞—Å–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –µ—Å–ª–∏ —á–µ–ª–æ–≤–µ–∫ –ø–æ–∑–∏—Ä–æ–≤–∞–ª –∑–∞ –ø–ª–∞—Ç—É.",
                "text": "–°—Ç–∞—Ç—å—è 152.1 –ø.1 –ø–ø.3: –°–æ–≥–ª–∞—Å–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –µ—Å–ª–∏ –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω –ø–æ–∑–∏—Ä–æ–≤–∞–ª –∑–∞ –ø–ª–∞—Ç—É."
            },
            {
                "code": "RF_GK_152_INTERNET_REMOVAL",
                "type": "MANDATORY",
                "risk": "HIGH",
                "summary": "–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏.",
                "text": "–°—Ç–∞—Ç—å—è 152.1 –ø.3: –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ —Å –Ω–∞—Ä—É—à–µ–Ω–∏–µ–º, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–æ –≤ —Å–µ—Ç–∏ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç, –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω –≤–ø—Ä–∞–≤–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –ø—Ä–µ—Å–µ—á–µ–Ω–∏—è –µ–≥–æ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è."
            }
        ]
        
        for req in requirements:
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
            req_id = uuid.uuid4()

            conn.execute(text("""
                INSERT INTO legal_requirement (id, doc_id, req_code, requirement_type, risk_floor, summary, full_text)
                VALUES (:id, :doc_id, :code, :type, :risk, :summ, :text)
                ON CONFLICT (req_code) DO UPDATE SET full_text = EXCLUDED.full_text
            """), {
                "id": req_id,       # <--- –î–û–ë–ê–í–õ–ï–ù–û
                "doc_id": doc_id,
                "code": req["code"],
                "type": req["type"],
                "risk": req["risk"],
                "summ": req["summary"],
                "text": req["text"]
            })
        
        conn.commit()
        print("‚úÖ –°—Ç–∞—Ç—å—è 152.1 –ì–ö –†–§ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞. –ê–≥–µ–Ω—Ç —Å–ª–µ–¥–∏—Ç –∑–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å—é.")

if __name__ == "__main__":
    seed_gk_152()