import os
from sqlalchemy import create_engine, text
import uuid

DATABASE_URL = os.getenv("DATABASE_URL")
engine = create_engine(DATABASE_URL)

ntv_policies = [
    {
        "code": "NTV_AGE18_001",
        "summary": "–ö–æ–Ω—Ç–µ–Ω—Ç 18+ (–Ω–∞—Ä–∫–æ—Ç–∏–∫–∏, –Ω–∞—Å–∏–ª–∏–µ, —Å–º–µ–Ω–∞ –ø–æ–ª–∞) —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ —Å 23:00 –¥–æ 04:00.",
        "type": "RESTRICTED",
        "risk": "HIGH",
        "text": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–∞—è –¥–ª—è –¥–µ—Ç–µ–π (–Ω–∞—Ä–∫–æ—Ç–∏–∫–∏, –∂–µ—Å—Ç–æ–∫–æ—Å—Ç—å, –õ–ì–ë–¢, —Å–º–µ–Ω–∞ –ø–æ–ª–∞), –º–æ–∂–µ—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å 23:00 –¥–æ 04:00 —Å –º–∞—Ä–∫–∏—Ä–æ–≤–∫–æ–π 18+."
    },
    {
        "code": "NTV_AGE16_001",
        "summary": "–ö–æ–Ω—Ç–µ–Ω—Ç 16+ (–±—Ä–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞, –Ω–µ–Ω–∞—Å–∏–ª—å—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–º–µ—Ä—Ç—å) —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ —Å 21:00 –¥–æ 07:00.",
        "type": "RESTRICTED",
        "risk": "MEDIUM",
        "text": "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è 16+ (–æ—Ç–¥–µ–ª—å–Ω—ã–µ –±—Ä–∞–Ω–Ω—ã–µ —Å–ª–æ–≤–∞, –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–æ–≤—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π) —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è —Å 21:00 –¥–æ 07:00."
    },
    {
        "code": "NTV_BAN_OBSCENE_001",
        "summary": "–ü–æ–ª–Ω—ã–π –∑–∞–ø—Ä–µ—Ç –Ω–∞ –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω—É—é –±—Ä–∞–Ω—å (–º–∞—Ç).",
        "type": "PROHIBITED",
        "risk": "CRITICAL",
        "text": "–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, —Å–æ–¥–µ—Ä–∂–∞—â–µ–π –Ω–µ—Ü–µ–Ω–∑—É—Ä–Ω—É—é –±—Ä–∞–Ω—å (4 —Å–ª–æ–≤–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ). –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–µ '–∑–∞–ø–∏–∫–∏–≤–∞–Ω–∏–µ' –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ."
    },
    {
        "code": "NTV_META_001",
        "summary": "–ó–∞–ø—Ä–µ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ª–æ–≥–æ—Ç–∏–ø–æ–≤ Meta, Facebook, Instagram.",
        "type": "PROHIBITED",
        "risk": "HIGH",
        "text": "–ó–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ—Ç–∏–ø–æ–≤ Meta Platforms Inc –∏ –µ–µ —Å–æ—Ü—Å–µ—Ç–µ–π. –í –∑–∞–ø–∏—Å–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É–¥–∞–ª–µ–Ω–∏–µ/–±–ª—é—Ä. –í –ø—Ä—è–º–æ–º —ç—Ñ–∏—Ä–µ - —É—Å—Ç–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ."
    },
    {
        "code": "NTV_FOREIGNAGENT_LABEL_001",
        "summary": "–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –∏–Ω–æ–∞–≥–µ–Ω—Ç–æ–≤ (15 —Å–µ–∫—É–Ω–¥, 20% —ç–∫—Ä–∞–Ω–∞).",
        "type": "MANDATORY",
        "risk": "HIGH",
        "text": "–ü—Ä–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–∏ –∏–Ω–æ–∞–≥–µ–Ω—Ç–∞ –∏–ª–∏ –ø–æ–∫–∞–∑–µ –µ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ø–ª–∞—à–∫–∞: '–î–ê–ù–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï...' (—Ç–µ–∫—Å—Ç –ø–æ –§–ó). –¢–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–Ω–∏–º–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 20% –ø–ª–æ—â–∞–¥–∏ –∏ –±—ã—Ç—å –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–º."
    }
]

def seed_ntv():
    with engine.connect() as conn:
        print("üì∫ –ó–∞–≥—Ä—É–∑–∫–∞ –ü–æ–ª–∏—Ç–∏–∫ –ù–¢–í...")
        
        # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –¥–æ–∫—É–º–µ–Ω—Ç–∞
        doc_id = uuid.uuid4()
        
        conn.execute(text("""
            INSERT INTO legal_doc (id, publisher, title, version) 
            VALUES (:id, '–ù–¢–í', '–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—é –ø—Ä–æ–≥—Ä–∞–º–º', '—Ä–µ–¥. 23.01.2024')
        """), {"id": doc_id})
        
        # 2. –í—Å—Ç–∞–≤–ª—è–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
        for p in ntv_policies:
            req_id = uuid.uuid4() # <--- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –ø—Ä–∞–≤–∏–ª–∞
            
            conn.execute(text("""
                INSERT INTO legal_requirement (id, doc_id, req_code, requirement_type, risk_floor, summary, full_text)
                VALUES (:id, :doc_id, :code, :type, :risk, :summ, :text)
                ON CONFLICT (req_code) DO NOTHING;
            """), {
                "id": req_id, # <--- –ü–µ—Ä–µ–¥–∞–µ–º ID
                "doc_id": doc_id,
                "code": p["code"],
                "type": p["type"],
                "risk": p["risk"],
                "summ": p["summary"],
                "text": p["text"]
            })
        conn.commit()
    print("‚úÖ NTV policies added.")

if __name__ == "__main__":
    seed_ntv()