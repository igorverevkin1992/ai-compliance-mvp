import os
from sqlalchemy import create_engine, text
import uuid

# –í—Å—Ç–∞–≤—å —Å–≤–æ—é —Å—Å—ã–ª–∫—É Supabase
DATABASE_URL = os.getenv("DATABASE_URL")
engine = create_engine(DATABASE_URL)

def seed_uk_280_3():
    with engine.connect() as conn:
        print("ü™ñ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç. 280.3 –£–ö –†–§ (–î–∏—Å–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è –∞—Ä–º–∏–∏) –≤ –±–∞–∑—É...")
        
        # 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –≤ Python
        doc_id = uuid.uuid4()
        
        # 2. –ü–µ—Ä–µ–¥–∞–µ–º –µ–≥–æ –≤ –∑–∞–ø—Ä–æ—Å
        conn.execute(text("""
            INSERT INTO legal_doc (id, publisher, title, version) 
            VALUES (:id, '–†–§', '–ù–∞–∑–≤–∞–Ω–∏–µ...', '–≤–µ—Ä—Å–∏—è...')
        """), {"id": doc_id})
        
        requirements = [
            {
                "code": "RF_UK_280_3_DISCREDITATION",
                "type": "PROHIBITED",
                "risk": "CRITICAL",
                "summary": "–ü—É–±–ª–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—é –í–° –†–§.",
                "text": "–°—Ç–∞—Ç—å—è 280.3 —á.1: –ó–∞–ø—Ä–µ—â–µ–Ω—ã –ø—É–±–ª–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –í–æ–æ—Ä—É–∂–µ–Ω–Ω—ã—Ö –°–∏–ª –†–§, –¥–æ–±—Ä–æ–≤–æ–ª—å—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–π –∏–ª–∏ –†–æ—Å–≥–≤–∞—Ä–¥–∏–∏. –í–∫–ª—é—á–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ –ø—Ä–∏–∑—ã–≤—ã –∫ –≤–æ—Å–ø—Ä–µ–ø—è—Ç—Å—Ç–≤–æ–≤–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–æ–π—Å–∫. (–ù–∞–∫–∞–∑–∞–Ω–∏–µ: –¥–æ 5 –ª–µ—Ç –ª–∏—à–µ–Ω–∏—è —Å–≤–æ–±–æ–¥—ã)."
            },
            {
                "code": "RF_UK_280_3_AGGRAVATED",
                "type": "PROHIBITED",
                "risk": "CRITICAL",
                "summary": "–î–∏—Å–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è, –ø–æ–≤–ª–µ–∫—à–∞—è —Ç—è–∂–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –∏–ª–∏ –º–∞—Å—Å–æ–≤—ã–µ –±–µ—Å–ø–æ—Ä—è–¥–∫–∏.",
                "text": "–°—Ç–∞—Ç—å—è 280.3 —á.2: –î–∏—Å–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è, –ø–æ–≤–ª–µ–∫—à–∞—è –ø—Ä–∏—á–∏–Ω–µ–Ω–∏–µ –≤—Ä–µ–¥–∞ –∑–¥–æ—Ä–æ–≤—å—é, –∏–º—É—â–µ—Å—Ç–≤—É, –º–∞—Å—Å–æ–≤—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ –∏–ª–∏ –ø–æ–º–µ—Ö–∏ —Ä–∞–±–æ—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. (–ù–∞–∫–∞–∑–∞–Ω–∏–µ: –¥–æ 7 –ª–µ—Ç –ª–∏—à–µ–Ω–∏—è —Å–≤–æ–±–æ–¥—ã)."
            }
        ]
        
        for req in requirements:
            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –¥–ª—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
            req_id = uuid.uuid4()

            conn.execute(text("""
                INSERT INTO legal_requirement (id, doc_id, req_code, requirement_type, risk_floor, summary, full_text)
                VALUES (:id, :doc_id, :code, :type, :risk, :summ, :text)
                ON CONFLICT (req_code) DO UPDATE SET full_text = EXCLUDED.full_text
            """), {
                "id": req_id,       # <--- –î–û–ë–ê–í–õ–ï–ù–û
                "doc_id": doc_id,
                "code": req["code"],
                "type": req["type"],
                "risk": req["risk"],
                "summ": req["summary"],
                "text": req["text"]
            })
        
        conn.commit()
        print("‚úÖ –°—Ç–∞—Ç—å—è 280.3 –£–ö –†–§ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞. –ê–≥–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –æ—Ç–ª–∏—á–∞–µ—Ç –∫—Ä–∏—Ç–∏–∫—É –æ—Ç –¥–∏—Å–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏.")

if __name__ == "__main__":
    seed_uk_280_3()